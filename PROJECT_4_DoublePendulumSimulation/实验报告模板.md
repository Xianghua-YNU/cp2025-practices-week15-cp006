
"""# 项目1：双摆动力学仿真 - 实验报告

**学生姓名：何芳州  
**学号：** 20231050200  
**完成日期：** 6.5

## 1. 实验目的
通过数值求解双摆的运动方程，理解其混沌特性，并分析能量守恒情况

## 2. 核心算法与实现

### 2.1 运动方程的数值解法
（简述你是如何设置并调用 `scipy.integrate.odeint` 来求解双摆的微分方程组的。提及你定义的 `derivatives` 函数的关键作用。）
本实验使用scipy.integrate.odeint求解双摆的微分方程组。首先定义了derivatives函数，其接收当前状态向量y（包含两个摆角和角速度）和时间t，返回状态向量的导数。该函数实现了双摆系统的动力学方程，通过计算摆角和角速度的变化率来描述系统状态的演变。然后，odeint以该函数为核心，结合初始条件和时间范围，进行数值积分求解，得到双摆在各个时刻的状态。

### 2.2 能量计算方法
（说明你是如何根据 $\theta_1, \omega_1, \theta_2, \omega_2$ 计算系统的总动能 $T$ 和总势能 $V$ 的，并给出总能量 $E = T+V$ 的表达式。）
根据 \(\theta_1, \omega_1, \theta_2, \omega_2\) 计算系统的总动能 T 和总势能 V，总能量 \(E = T+V\)。动能表达式：\(T = m*L^2 * (\omega_1^2 + 0.5\omega_2^2 + \omega_1\omega_2\cos(\theta_1-\theta_2))\)势能表达式：\(V = -m*g*L*(2\cos(\theta_1) + \cos(\theta_2))\)

### 2.3 关键代码片段
```python
# 粘贴你认为最核心的1-2个代码片段，例如 derivatives 函数的实现，或者能量计算部分。
# derivatives 函数实现：
def derivatives(y, t, L1, L2, m1, m2, g_param):
    theta1, omega1, theta2, omega2 = y

    dtheta1_dt = omega1
    dtheta2_dt = omega2

    # 计算domega1_dt的分子和分母
    num1 = -omega1 ** 2 * np.sin(2 * theta1 - 2 * theta2) \
           - 2 * omega2 ** 2 * np.sin(theta1 - theta2) \
           - (g_param / L1) * (np.sin(theta1 - 2 * theta2) + 3 * np.sin(theta1))
    den1 = 3 - np.cos(2 * theta1 - 2 * theta2)  # 假设m1=m2, L1=L2
    domega1_dt = num1 / den1

    # 计算domega2_dt的分子和分母
    num2 = 4 * omega1 ** 2 * np.sin(theta1 - theta2) \
           + omega2 ** 2 * np.sin(2 * theta1 - 2 * theta2) \
           + 2 * (g_param / L1) * (np.sin(2 * theta1 - theta2) - np.sin(theta2))
    den2 = 3 - np.cos(2 * theta1 - 2 * theta2)  # 假设m1=m2, L1=L2
    domega2_dt = num2 / den2

    return [dtheta1_dt, domega1_dt, dtheta2_dt, domega2_dt]

# 能量计算部分：
def calculate_energy(sol_arr, L_param, m_param, g_param):
    theta1 = sol_arr[:, 0]
    omega1 = sol_arr[:, 1]
    theta2 = sol_arr[:, 2]
    omega2 = sol_arr[:, 3]

    # 势能计算
    V = -m_param * g_param * L_param * (2 * np.cos(theta1) + np.cos(theta2))

    # 动能计算
    T = m_param * L_param ** 2 * (omega1 ** 2 + 0.5 * omega2 ** 2 + omega1 * omega2 * np.cos(theta1 - theta2))

    return T + V

## 3. 实验结果与分析

### 3.1 能量守恒分析
（粘贴你生成的“能量 vs. 时间”图像。分析图像，讨论能量是否守恒。如果存在数值误差导致的不守恒，量化这个误差（例如，总能量的变化范围或标准差），并讨论你是如何通过调整 `odeint` 的参数（如 `rtol`, `atol`）或增加 `t_points` 来尝试满足题目 $10^{-5}$ 焦耳的精度要求的。）
从生成的 “能量 vs. 时间” 图像可以看出，总能量随时间有微小波动。具体数据如下：初始能量：-7.8480000 J最终能量：-7.8479999 J最大能量变化：9.8070000e-07 J能量变化范围远小于\(10^{-5}\)焦耳，说明在当前参数设置下，系统能量基本守恒。为满足精度要求，实验中采取了以下措施：增加了时间点数t_points至 2000，减小了时间步长，提高了数值积分的精度。显式设置了odeint的相对容差rtol和绝对容差atol为\(10^{-9}\)，增强了求解的稳定性。

**(在此处插入能量随时间变化的图像)**![72f2e5dda8f0fa9725646df2cb944cf](https://github.com/user-attachments/assets/512448f7-d5b0-4330-a45b-436c537715e7)


### 3.2 双摆运动轨迹 (可选，如果未做动画则省略)
（如果你完成了动画部分，可以简要描述双摆的典型运动特征，例如混沌行为、对初始条件的敏感性等。可以附上一张动画中的截图。）
双摆的运动呈现出明显的混沌特性，对初始条件极为敏感。即使初始角度仅有微小差异，随着时间的推移，两个摆的运动轨迹也会出现显著分歧。这一现象印证了混沌系统的典型特征，即系统的长期行为无法通过初始条件精确预测。

**(在此处插入动画截图，如果适用)**![054e573558220a11ba5a85277b48dfa](https://github.com/user-attachments/assets/7764a6ee-91b4-47e2-8eb6-3318b30501f1)


## 4. 问题与收获

### 4.1 遇到的主要问题
（列出1-2个在实现过程中遇到的主要困难或挑战，例如：理解微分方程组、调试 `odeint` 参数、实现动画等。）
理解双摆系统的微分方程组较为困难，尤其是复杂的加速度表达式推导。
调试odeint参数以满足能量守恒精度要求时，需要反复试验不同的参数组合。

### 4.2 解决方法与学习心得
（简述你是如何解决上述问题的。总结通过本次实验学到的主要知识点、技能或对计算物理的理解，例如：数值求解ODE的经验、混沌系统特性、能量分析的重要性等。）
通过查阅教材和网络资源，深入学习了拉格朗日力学方法，理解了双摆系统方程的推导过程。
采用控制变量法，逐步调整odeint的参数（如rtol、atol和t_points），观察能量变化情况，最终找到满足精度要求的参数设置。

### 4.3 主要收获
（用3-5句话总结你从这个项目中学到的最重要的东西。）
掌握了使用数值方法求解复杂微分方程组的技能，加深了对计算物理的理解。
深刻体会到混沌系统对初始条件的敏感性，以及在数值模拟中保证能量守恒的重要性。
学会了如何通过调整数值计算参数提高模拟精度，以及如何分析和解释模拟结果。

## 5. 思考题（可选）

1.  如果双摆的两个摆臂长度不同（ $L_1 \neq L_2$）或两个摆锤质量不同（ $m_1 \neq m_2$），运动方程会如何变化？你将如何修改你的 `derivatives` 函数来适应这种情况？（提示：需要回顾拉格朗日方程的推导或查找更通用的双摆方程。）
den1_general = (m1 + m2) * L1 - m2 * L1 * np.cos(theta1 - theta2)**2
den2_general = (m1 + m2) * L2 - m2 * L2 * np.cos(theta1 - theta2)**2
2.  双摆的运动对初始条件高度敏感。尝试稍微改变初始角度（例如，将 $\theta_1$ 或 $\theta_2$ 改变 $0.001$ 弧度），重新运行仿真，并比较两个轨迹（例如，绘制 $\theta_1(t)$ 的对比图）。你观察到了什么现象？这与混沌理论有什么关系？
当稍微改变初始角度（如将\(\theta_1\)或\(\theta_2\)改变\(0.001\)弧度）后，重新运行仿真会发现，两个轨迹在初始阶段非常接近，但随着时间的推移，差异会逐渐增大，最终变得完全不同。这一现象直接体现了混沌系统对初始条件的高度敏感性，即所谓的 “蝴蝶效应”。在混沌系统中，初始条件的微小差异会导致系统演化路径的巨大分歧，这正是混沌理论的核心观点之一。

---

_报告长度建议：500-1000字（不含代码和图片），重点关注对物理模型、数值方法和结果分析的理解与反思。_
